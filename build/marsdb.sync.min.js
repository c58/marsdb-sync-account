!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,(t.Mars||(t.Mars={})).Meteor=e()}}(function(){return function e(t,n,r){function o(a,u){if(!n[a]){if(!t[a]){var s="function"==typeof require&&require;if(!u&&s)return s(a,!0);if(i)return i(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[a]={exports:{}};t[a][0].call(l.exports,function(e){var n=t[a][1][e];return o(n?n:e)},l,l.exports,e,t,n,r)}return n[a].exports}for(var i="function"==typeof require&&require,a=0;a<r.length;a++)o(r[a]);return o}({1:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=e("marsdb-sync-client"),u=r(a),s="undefined"!=typeof localStorage||null,c="auth.login.token",l="auth.login.id",d=function(){function e(){var t=this;o(this,e),this._unsetLoginData=function(){s&&(localStorage.removeItem(c),localStorage.removeItem(l))},this._handleLoginResponse=function(e){var t=e.userId,n=e.token;return s&&(localStorage.setItem(c,n),localStorage.setItem(l,t)),t},this._handleLoginError=function(e){throw t._unsetLoginData(),e}}return i(e,[{key:"login",value:function(e,t){return u["default"].call("/auth/basic/login",e,t).then(this._handleLoginResponse,this._handleLoginError)}},{key:"logout",value:function(){u["default"].call("/auth/basic/logout"),this._unsetLoginData()}},{key:"register",value:function(e,t){return u["default"].call("/auth/basic/register",e,t).then(this._handleLoginResponse,this._handleLoginError)}},{key:"restoreLogin",value:function(){var e=this;return Promise.resolve().then(function(){var t=e._getRestoreLoginToken();if(t)return u["default"].call("/auth/token/login",t);throw new Error("No login toke found")}).then(this._handleLoginResponse,this._handleLoginError)}},{key:"getSavedUserId",value:function(){return s&&localStorage.getItem(l)}},{key:"_getRestoreLoginToken",value:function(){return s&&localStorage.getItem(c)}}]),e}();n["default"]=d},{"marsdb-sync-client":15}],2:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var u=function(){function e(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var a,u=e[Symbol.iterator]();!(r=(a=u.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(s){o=!0,i=s}finally{try{!r&&u["return"]&&u["return"]()}finally{if(o)throw i}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=e("marsdb"),l=e("marsdb-sync-client"),d=r(l),f=e("./BasicLoginClient"),h=r(f),p="/_auth/oauth",y="undefined"!=typeof window&&!!window.cordova,g="undefined"!=typeof localStorage,v={};"undefined"!=typeof window&&(window.__handleCredentialSecret=function(e,t){v[e]=t});var _=function(e){function t(){return o(this,t),i(this,Object.getPrototypeOf(t).apply(this,arguments))}return a(t,e),s(t,[{key:"login",value:function(e){var t=this,n=c.Random["default"]().id(),r=p+"/popup/"+e+"/"+n;return new Promise(function(e,o){t._showPopup(r,function(){var r=v[n]||g&&localStorage.getItem(n);r?(delete v[n],g&&localStorage.removeItem(n),d["default"].call(p+"/secret/login",n,r).then(t._handleLoginResponse,o).then(e)):o(new Error("No secret for given credential token"))})}).then(null,this._handleLoginError)}},{key:"loginWithToken",value:function(e,t){return d["default"].call(p+"/token/login",e,t).then(this._handleLoginResponse,this._handleLoginError)}},{key:"_handleCredentialSecret",value:function(e,t){v[e]=t}},{key:"_showPopup",value:function(e,t){throw new Error("Not implemented")}}]),t}(h["default"]),m=function(e){function t(){return o(this,t),i(this,Object.getPrototypeOf(t).apply(this,arguments))}return a(t,e),s(t,[{key:"_showPopup",value:function(e,t,n){var r=this,o=this._openCenteredPopup(e,n&&n.width||650,n&&n.height||331),i=function(e){var t=e.data.split(":"),n=u(t,2),o=n[0],i=n[1];o&&i&&r._handleCredentialSecret(o,i)},a=setInterval(function(){var e=void 0;try{e=o.closed||void 0===o.closed}catch(n){return}e&&(window.removeEventListener("message",i),clearInterval(a),t())},100);window.addEventListener("message",i,!1)}},{key:"_openCenteredPopup",value:function(e,t,n){var r="undefined"!=typeof window.screenX?window.screenX:window.screenLeft,o="undefined"!=typeof window.screenY?window.screenY:window.screenTop,i="undefined"!=typeof window.outerWidth?window.outerWidth:document.body.clientWidth,a="undefined"!=typeof window.outerHeight?window.outerHeight:document.body.clientHeight-22,u=r+(i-t)/2,s=o+(a-n)/2,c="width="+t+",height="+n+",left="+u+",top="+s+",scrollbars=yes",l=window.open(e,"Login",c);if("undefined"==typeof l){var d=new Error("The login popup was blocked by the browser");throw d.attemptedUrl=e,d}return l.focus&&l.focus(),l}}]),t}(_),b=function(e){function t(){return o(this,t),i(this,Object.getPrototypeOf(t).apply(this,arguments))}return a(t,e),s(t,[{key:"_showPopup",value:function(e,t,n){var r=this,o=function(e){t(new Error("Error from OAuth popup: "+JSON.stringify(e)))},i=!1,a=function c(e){if(!i&&e.url.indexOf("_oauth")>=0){var n=e.url.split("#"),o=n[1];if(!o)return void setTimeout(c,100);var a=JSON.parse(decodeURIComponent(o));r._handleCredentialSecret(a.credentialToken,a.credentialSecret),i=!0,setTimeout(function(){s.close(),t()},100)}},u=function l(){s.removeEventListener("loadstop",a),s.removeEventListener("loaderror",o),s.removeEventListener("exit",l),i||t(new Error("Login canceled"))},s=window.open(e,"_blank","location=yes,hidden=yes,clearcache=yes,clearsessioncache=yes");s.addEventListener("loadstop",a),s.addEventListener("loaderror",o),s.addEventListener("exit",u),s.show()}}]),t}(_);n["default"]=y?b:m},{"./BasicLoginClient":1,marsdb:void 0,"marsdb-sync-client":15}],3:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e){var t=e.find({_id:g.getSavedUserId()});return _.on("change",function(e){t.find({_id:e}),t.update()}),t}function i(){g.logout(),m(null)}function a(){return g.restoreLogin().then(m)}function u(e,t){return g.login(e,t).then(m)}function s(e,t){return g.register(e,t).then(m)}function c(e){return v.login(e).then(m)}function l(e,t){return v.loginWithToken(e,t).then(m)}Object.defineProperty(n,"__esModule",{value:!0}),n.currentUser=o,n.logout=i,n.restoreLogin=a,n.loginBasic=u,n.register=s,n.loginOAuth=c,n.loginOAuthToken=l;var d=e("marsdb"),f=e("./OAuthLoginClient"),h=r(f),p=e("./BasicLoginClient"),y=r(p),g=new y["default"],v=new h["default"],_=new d.EventEmitter,m=function(e){return _.emit("change",e),e}},{"./BasicLoginClient":1,"./OAuthLoginClient":2,marsdb:void 0}],4:[function(e,t,n){t.exports=e("./dist/client")},{"./dist/client":3}],5:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function u(e){var t=g.defaultDelegate(),n=function(t){function n(){var t;o(this,n);for(var r=arguments.length,a=Array(r),u=0;r>u;u++)a[u]=arguments[u];var s=i(this,(t=Object.getPrototypeOf(n)).call.apply(t,[this].concat(a)));return e.on("status:connected",(0,d["default"])(s._handleConnected,s)),e.on("message:added",(0,d["default"])(s._handleRemoteAdded,s)),e.on("message:changed",(0,d["default"])(s._handleRemoteChanged,s)),e.on("message:removed",(0,d["default"])(s._handleRemoteRemoved,s)),s}return a(n,t),s(n,[{key:"insert",value:function(t){var r=this,o=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],i=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],a=void 0;if(!o.quiet){var u="/"+this.db.modelName+"/insert",s=function(e){return a.then(function(){return r.db.remove(t._id,{quiet:!0})}).then(function(){throw e})},l=e.methodManager.apply(u,[t,o],i.seed).then(null,s);if(o.waitResult)return l}return a=c(Object.getPrototypeOf(n.prototype),"insert",this).call(this,t,o,i)}},{key:"remove",value:function(t){var r=this,o=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],i=void 0;if(!o.quiet){var a="/"+this.db.modelName+"/remove",u=function(e){return i.then(function(e){return r.db.insertAll(e,{quiet:!0})}).then(function(){throw e})},s=e.methodManager.apply(a,[t,o]).then(null,u);if(o.waitResult)return s}return i=c(Object.getPrototypeOf(n.prototype),"remove",this).call(this,t,o)}},{key:"update",value:function(t,r){var o=this,i=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],a=void 0;if(!i.quiet){var u="/"+this.db.modelName+"/update",s=function(e){return a.then(function(e){(0,h["default"])(e.updated,function(t,n){if(e.original[n]){var r=e.original[n]._id;delete e.original[n]._id,o.db.update({_id:r},e.original[n],{quiet:!0,upsert:!0})}else o.db.remove(t._id,{quiet:!0})})}).then(function(){throw e})},l=e.methodManager.apply(u,[t,r,i]).then(null,s);if(i.waitResult)return l}return a=c(Object.getPrototypeOf(n.prototype),"update",this).call(this,t,r,i)}},{key:"_handleRemoteAdded",value:function(e){return delete e.fields._id,this.db.update({_id:e.id},e.fields,{quiet:!0,upsert:!0})}},{key:"_handleRemoteChanged",value:function(e){var t={};if(Array.isArray(e.cleared)&&e.cleared.length>0){t.$unset={};var n=!0,r=!1,o=void 0;try{for(var i,a=e.cleared[Symbol.iterator]();!(n=(i=a.next()).done);n=!0){var u=i.value;t.$unset[u]=1}}catch(s){r=!0,o=s}finally{try{!n&&a["return"]&&a["return"]()}finally{if(r)throw o}}}return e.fields&&(delete e.fields._id,t.$set={},(0,h["default"])(e.fields,function(e,n){t.$set[n]=e})),(0,y["default"])(t).length>0?this.db.update(e.id,t,{quiet:!0}):void 0}},{key:"_handleRemoteRemoved",value:function(e){return this.db.remove(e.id,{quiet:!0})}},{key:"_handleConnected",value:function(t){var n=this,r="/"+this.db.modelName+"/sync";return this.db.ids().then(function(t){return e.methodManager.apply(r,[t]).result()}).then(function(e){return n.db.remove({_id:{$in:e}},{quiet:!0,multi:!0})})}}]),n}(t);return n}var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=function v(e,t,n){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,t);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:v(o,t,n)}if("value"in r)return r.value;var i=r.get;if(void 0!==i)return i.call(n)};Object.defineProperty(n,"__esModule",{value:!0}),n.createCollectionDelegate=u;var l=e("fast.js/function/bind"),d=r(l),f=e("fast.js/forEach"),h=r(f),p=e("fast.js/object/keys"),y=r(p),g="undefined"!=typeof window&&window.Mars?window.Mars.Collection:e("marsdb").Collection},{"fast.js/forEach":18,"fast.js/function/bind":21,"fast.js/object/keys":26,marsdb:void 0}],6:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function s(e,t){var n=!1;return"function"==typeof e?n=e(t):(Array.isArray(t)&&t.length>0||"[object Object]"===Object.prototype.toString.call(t)&&(0,h["default"])(t).length>0)&&(n=!0),n}function c(e){var t=p.defaultCursor(),n=function(t){function n(){return i(this,n),a(this,Object.getPrototypeOf(n).apply(this,arguments))}return u(n,t),l(n,[{key:"_doUpdate",value:function(t){var r=this,i=this.options,a=i.sub,u=i.waitReady,c=i.tryCache,l=function(){return d(Object.getPrototypeOf(n.prototype),"_doUpdate",r).call(r,t)};if(!this._subscription&&a){var f;if(this._subscription=(f=e.subManager).subscribe.apply(f,o(a)),this.once("observeStopped",function(){r._subscription.stop(),delete r._subscription}),u)return this._subscription.ready().then(l);if(c)return this.exec().then(function(e){return s(c,e)?(r._updateLatestIds(),r._propagateUpdate(t).then(function(){return e})):r._subscription.ready().then(l)})}return l()}}]),n}(t);return n}var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),d=function y(e,t,n){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,t);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:y(o,t,n)}if("value"in r)return r.value;var i=r.get;if(void 0!==i)return i.call(n)};Object.defineProperty(n,"__esModule",{value:!0}),n._isCacheValid=s,n.createCursorWithSub=c;var f=e("fast.js/object/keys"),h=r(f),p="undefined"!=typeof window&&window.Mars?window.Mars.Collection:e("marsdb").Collection},{"fast.js/object/keys":26,marsdb:void 0}],7:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(n,"__esModule",{value:!0}),n.CONN_STATUS=void 0;var s=e("fast.js/function/try"),c=r(s),l=e("fast.js/function/bind"),d=r(l),f=e("./HeartbeatManager"),h=r(f),p="undefined"!=typeof window&&window.Mars?window.Mars.EventEmitter:e("marsdb").EventEmitter,y="undefined"!=typeof window&&window.Mars?window.Mars.PromiseQueue:e("marsdb").PromiseQueue,g="undefined"!=typeof window&&window.Mars?window.Mars.EJSON:e("marsdb").EJSON,v="undefined"!=typeof window&&window.Mars?window.Mars.Random:e("marsdb").Random,_=1,m=17500,b=15e3,w=5e3,E=n.CONN_STATUS={CONNECTING:"CONNECTING",CONNECTED:"CONNECTED",DISCONNECTED:"DISCONNECTED"},O=function(e){function t(e){var n=e.url,r=e.socket,a=void 0===r?WebSocket:r,u=e.autoReconnect,s=void 0===u?!0:u;o(this,t);var c=i(this,Object.getPrototypeOf(t).call(this));return c.url=n,c._queue=new y(1),c._sessionId=null,c._autoReconnect=s,c._socket=a,c._status=E.DISCONNECTED,c._heartbeat=new h["default"](m,b),c._heartbeat.on("timeout",(0,d["default"])(c._handleHearbeatTimeout,c)),c._heartbeat.on("sendPing",(0,d["default"])(c.sendPing,c)),c._heartbeat.on("sendPong",(0,d["default"])(c.sendPong,c)),c.connect(),c}return a(t,e),u(t,[{key:"sendMethod",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?[]:arguments[1],n=arguments[2],r=arguments[3],o={msg:"method",id:n,method:e,params:t};r&&(o.randomSeed=r),this._sendMessage(o)}},{key:"sendSub",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?[]:arguments[1],n=arguments[2];this._sendMessage({msg:"sub",id:n,name:e,params:t})}},{key:"sendUnsub",value:function(e){this._sendMessage({msg:"unsub",id:e})}},{key:"sendPing",value:function(){this._sendMessage({msg:"ping",id:v["default"]().id(20)})}},{key:"sendPong",value:function(e){this._sendMessage({msg:"pong",id:e})}},{key:"connect",value:function(){return this.isDisconnected?(this._rawConn=new this._socket(this.url),this._rawConn.onopen=(0,d["default"])(this._handleOpen,this),this._rawConn.onerror=(0,d["default"])(this._handleError,this),this._rawConn.onclose=(0,d["default"])(this._handleClose,this),this._rawConn.onmessage=(0,d["default"])(this._handleRawMessage,this),this._setStatus(E.CONNECTING),!0):!1}},{key:"reconnect",value:function(){var e=this;return this.isDisconnected?(clearTimeout(this._reconnTimer),this._reconnecting=!0,this._reconnTimer=setTimeout((0,d["default"])(this.connect,this),w),function(){clearTimeout(e._reconnTimer),e._reconnecting=!1,e.disconnect()}):void 0}},{key:"disconnect",value:function(){var e=this;(0,c["default"])(function(){return e._rawConn&&e._rawConn.close()})}},{key:"_handleOpen",value:function(){this._heartbeat.waitPing(),this._sendMessage({msg:"connect",session:this._sessionId,version:_,support:[_]})}},{key:"_handleConnectedMessage",value:function(e){this.isConnected||(this._setStatus(E.CONNECTED,this._reconnecting),this._sessionId=e.session,this._reconnecting=!1)}},{key:"_handleClose",value:function(){this._heartbeat._clearTimers(),this._setStatus(E.DISCONNECTED),this._autoReconnect&&(this._reconnecting=!1,this.reconnect())}},{key:"_handleHearbeatTimeout",value:function(){this.disconnect()}},{key:"_handleError",value:function(e){this.emit("error",e)}},{key:"_handleRawMessage",value:function(e){var t=this;return this._queue.add(function(){var n=g.parse(e.data);return t._processMessage(n)}).then(null,function(e){t._handleError(e)})}},{key:"_processMessage",value:function(e){switch(e.msg){case"connected":return this._handleConnectedMessage(e);case"ping":return this._heartbeat.handlePing(e);case"pong":return this._heartbeat.handlePong(e);case"removed":case"changed":case"added":case"updated":case"result":case"nosub":case"ready":case"error":return this.emitAsync("message:"+e.msg,e);default:throw new Error("Unknown message type "+e.msg)}}},{key:"_sendMessage",value:function(e){var t=this,n=(0,c["default"])(function(){return t._rawConn.send(g.stringify(e))});n instanceof Error&&this._handleError(n)}},{key:"_setStatus",value:function(e,t){this._status=e,this.emit(("status:"+e).toLowerCase(),t)}},{key:"isConnected",get:function(){return this._status===E.CONNECTED}},{key:"isDisconnected",get:function(){return this._status===E.DISCONNECTED}}]),t}(p);n["default"]=O},{"./HeartbeatManager":9,"fast.js/function/bind":21,"fast.js/function/try":23,marsdb:void 0}],8:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(n,"__esModule",{value:!0});var a=e("fast.js/function/bind"),u=r(a),s=function(){function e(t){o(this,e),this.conn=t,t.on("message:error",(0,u["default"])(this._handleError,this)),t.on("error",(0,u["default"])(this._handleError,this))}return i(e,[{key:"_handleError",value:function(e){e&&e.message?console.warn(e.message+"\n"+e.stack):console.warn(JSON.stringify(e))}}]),e}();n["default"]=s},{"fast.js/function/bind":21}],9:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(n,"__esModule",{value:!0});var u="undefined"!=typeof window&&window.Mars?window.Mars.EventEmitter:e("marsdb").EventEmitter,s=function(e){function t(){var e=arguments.length<=0||void 0===arguments[0]?17500:arguments[0],n=arguments.length<=1||void 0===arguments[1]?1e4:arguments[1];r(this,t);var i=o(this,Object.getPrototypeOf(t).call(this));return i.pingTimeout=e,i.pongTimeout=n,i}return i(t,e),a(t,[{key:"waitPing",value:function(){var e=this;this._clearTimers(),this.waitPingTimer=setTimeout(function(){e.emit("sendPing"),e.waitPong()},this.pingTimeout)}},{key:"waitPong",value:function(){var e=this;this._clearTimers(),this.waitPongTimer=setTimeout(function(){return e.emit("timeout")},this.pongTimeout)}},{key:"handlePing",value:function(e){this._clearTimers(),this.emit("sendPong",e),this.waitPing()}},{key:"handlePong",value:function(){this._clearTimers(),this.waitPing()}},{key:"_clearTimers",value:function(){clearTimeout(this.waitPingTimer),clearTimeout(this.waitPongTimer)}}]),t}(u);n["default"]=s},{marsdb:void 0}],10:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(n,"__esModule",{value:!0});var u="undefined"!=typeof window&&window.Mars?window.Mars.EventEmitter:e("marsdb").EventEmitter,s="undefined"!=typeof window&&window.Mars?window.Mars.Random:e("marsdb").Random,c=n.CALL_STATUS={RESULT:"RESULT",ERROR:"ERROR",UPDATED:"UPDATED"},l=function(e){function t(e,n,i,a){r(this,t);var u=o(this,Object.getPrototypeOf(t).call(this));return u.result=function(){return u._promiseMixed(new Promise(function(e,t){u._error?t(u._error):u._result?e(u._result):(u.once(c.RESULT,e),u.once(c.ERROR,t))}))},u.updated=function(){return u._promiseMixed(new Promise(function(e,t){u._updated?e():u.once(c.UPDATED,e)}))},u.id=s["default"]().id(20),a.sendMethod(e,n,u.id,i),u}return i(t,e),a(t,[{key:"then",value:function(e,t){var n=this;return this.updated().then(function(){return n.result().then(e,t)},t)}},{key:"_promiseMixed",value:function(e){var t=this;return{result:this.result,updated:this.updated,then:function(){return t._promiseMixed(e.then.apply(e,arguments))}}}},{key:"_handleResult",value:function(e,t){e?(this._error=e,this.emit(c.ERROR,e)):(this._result=t,this.emit(c.RESULT,t))}},{key:"_handleUpdated",value:function(e){this._updated=!0,this.emit(c.UPDATED)}}]),t}(u);n["default"]=l},{marsdb:void 0}],11:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(n,"__esModule",{value:!0});var a=e("fast.js/function/bind"),u=r(a),s=e("fast.js/forEach"),c=r(s),l=e("./MethodCall"),d=r(l),f=function(){function e(t){o(this,e),this.conn=t,this._methods={},t.on("status:disconnected",(0,u["default"])(this._handleDisconnected,this)),t.on("message:result",(0,u["default"])(this._handleMethodResult,this)),t.on("message:updated",(0,u["default"])(this._handleMethodUpdated,this))}return i(e,[{key:"call",value:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;t>r;r++)n[r-1]=arguments[r];return this.apply(e,n)}},{key:"apply",value:function(e){var t=this,n=arguments.length<=1||void 0===arguments[1]?[]:arguments[1],r=arguments[2],o=new d["default"](e,n,r,this.conn);this._methods[o.id]=o;var i=function(){t._methods[o.id]&&t._methods[o.id]._result&&t._methods[o.id]._updated&&delete t._methods[o.id]};return o.result().then(i).updated().then(i),o}},{key:"_handleMethodResult",value:function(e){if(e.id&&this._methods[e.id]){var t=e.result,n=e.error;this._methods[e.id]._handleResult(n,t)}}},{key:"_handleMethodUpdated",value:function(e){var t=this;(0,c["default"])(e.methods,function(e){t._methods[e]&&t._methods[e]._handleUpdated()})}},{key:"_handleDisconnected",value:function(){(0,c["default"])(this._methods,function(e){e._handleResult({reason:"Disconnected, method can't be done"})}),this._methods={}}}]),e}();n["default"]=f},{"./MethodCall":10,"fast.js/forEach":18,"fast.js/function/bind":21}],12:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(n,"__esModule",{value:!0});var u="undefined"!=typeof window&&window.Mars?window.Mars.EventEmitter:e("marsdb").EventEmitter,s="undefined"!=typeof window&&window.Mars?window.Mars.Random:e("marsdb").Random,c=n.SUB_STATUS={READY_PENDING:"READY_PENDING",READY:"READY",ERROR:"ERROR",STOP_PENDING:"STOP_PENDING",STOPPED:"STOPPED",FROZEN:"FROZEN"},l=function(e){function t(e,n,i){var a=arguments.length<=3||void 0===arguments[3]?15e3:arguments[3];r(this,t);var u=o(this,Object.getPrototypeOf(t).call(this));return u.ready=function(){return u._promiseMixed(new Promise(function(e,t){u.isReady?e():(u.once(c.READY,e),u.once(c.ERROR,t))}))},u.stopped=function(){return u._promiseMixed(new Promise(function(e,t){u.isStopped?e():(u.once(c.STOPPED,e),u.once(c.ERROR,t))}))},u.stop=function(){u._scheduleStop()},u.id=s["default"]().id(20),u.name=e,u.params=n,u._conn=i,u._ready=!1,u._stopWaitTimeout=a,u}return i(t,e),a(t,[{key:"then",value:function(e,t){return this.ready().then(e,t)}},{key:"_promiseMixed",value:function(e){var t=this;return{stopped:this.stopped,ready:this.ready,stop:this.stop,then:function(){return t._promiseMixed(e.then.apply(e,arguments))}}}},{key:"_subscribe",value:function(){this.status&&this.status!==c.STOP_PENDING&&this.status!==c.STOPPED&&this.status!==c.ERROR&&this.status!==c.FROZEN||(this.status===c.STOP_PENDING?this._ready?(this._clearStopper(),this._setStatus(c.READY)):this._setStatus(c.READY_PENDING):(this._setStatus(c.READY_PENDING),this._conn.sendSub(this.name,this.params,this.id)))}},{key:"_scheduleStop",value:function(){var e=this;this.status!==c.STOP_PENDING&&this.status!==c.STOPPED&&(this._setStatus(c.STOP_PENDING),this._stopTimer=setTimeout(function(){return e._stopImmediately()},this._stopWaitTimeout))}},{key:"_stopImmediately",value:function(e){this.status!==c.STOPPED&&(this._clearStopper(),this._setStatus(c.STOPPED),this._ready=!1,e&&e.dontSendMsg||this._conn.sendUnsub(this.id))}},{key:"_freeze",value:function(){this.status===c.STOP_PENDING?this._stopImmediately({dontSendMsg:!0}):this.status&&this.status===c.STOPPED||this._setStatus(c.FROZEN)}},{key:"_setStatus",value:function(e,t,n,r,o){this.status=e,this.emit(e,t,n,r,o)}},{key:"_clearStopper",value:function(){clearTimeout(this._stopTimer),this._stopTimer=null}},{key:"_handleNosub",value:function(e){this._clearStopper(),e?this._setStatus(c.ERROR,e):this._stopImmediately({dontSendMsg:!0})}},{key:"_handleReady",value:function(){this.status!==c.STOPPED&&this.status!==c.STOP_PENDING&&(this._ready=!0,this._setStatus(c.READY))}},{key:"isReady",get:function(){return this.status==c.READY||this.status===c.FROZEN&&this._ready}},{key:"isReadyPending",get:function(){return this.status===c.READY_PENDING}},{key:"isStopped",get:function(){return this.status===c.STOPPED}},{key:"isStopPending",get:function(){return this.status===c.STOP_PENDING}},{key:"isFaulted",get:function(){return this.status===c.ERROR}},{key:"isFrozen",get:function(){return this.status==c.FROZEN}}]),t}(u);n["default"]=l},{marsdb:void 0}],13:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(n,"__esModule",{value:!0});var s=e("fast.js/function/bind"),c=r(s),l=e("fast.js/forEach"),d=r(l),f=e("./Subscription"),h=r(f),p="undefined"!=typeof window&&window.Mars?window.Mars.EventEmitter:e("marsdb").EventEmitter,y=15e3,g=function(e){
function t(e){o(this,t);var n=i(this,Object.getPrototypeOf(t).call(this));return n._subs={},n._loading=new Set,n._conn=e,e.on("status:connected",(0,c["default"])(n._handleConnected,n)),e.on("status:disconnected",(0,c["default"])(n._handleDisconnected,n)),e.on("message:ready",(0,c["default"])(n._handleSubscriptionReady,n)),e.on("message:nosub",(0,c["default"])(n._handleSubscriptionNosub,n)),n}return a(t,e),u(t,[{key:"subscribe",value:function(e){for(var t=this,n=arguments.length,r=Array(n>1?n-1:0),o=1;n>o;o++)r[o-1]=arguments[o];var i=new h["default"](e,r,this._conn,y);this._subs[i.id]=i,this._trackLoadingStart(i.id);var a=function(){delete t._subs[i.id],t._trackLoadingReady(i.id)};return i.once(f.SUB_STATUS.STOPPED,a),i.once(f.SUB_STATUS.ERROR,a),this._conn.isConnected?i._subscribe():i._freeze(),i}},{key:"addReadyListener",value:function(e){var t=this;return this.on("ready",e),function(){return t.removeListener("ready",e)}}},{key:"addLoadingListener",value:function(e){var t=this;return this.on("loading",e),function(){return t.removeListener("loading",e)}}},{key:"_handleConnected",value:function(){(0,d["default"])(this._subs,function(e){return e._subscribe()})}},{key:"_handleDisconnected",value:function(){var e=this;(0,d["default"])(this._subs,function(t,n){t._freeze(),t.isFrozen?e._trackLoadingStart(n):e._trackLoadingReady(n)})}},{key:"_handleSubscriptionReady",value:function(e){var t=this;(0,d["default"])(e.subs,function(e){var n=t._subs[e];n&&(n._handleReady(),t._trackLoadingReady(e))})}},{key:"_handleSubscriptionNosub",value:function(e){var t=this._subs[e.id];t&&t._handleNosub(e.error)}},{key:"_trackLoadingStart",value:function(e){var t=this._loading.size;this._loading.add(e),0===t&&this._loading.size>0&&this.emit("loading")}},{key:"_trackLoadingReady",value:function(e){var t=this._loading.size;this._loading["delete"](e),t>0&&0===this._loading.size&&this.emit("ready")}}]),t}(p);n["default"]=g},{"./Subscription":12,"fast.js/forEach":18,"fast.js/function/bind":21,marsdb:void 0}],14:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(){return P}function i(){var e;return(e=P.methodManager).call.apply(e,arguments)}function a(){var e;return(e=P.methodManager).apply.apply(e,arguments)}function u(){var e;return(e=P.subManager).subscribe.apply(e,arguments)}function s(e){var t=e.url,n=e.managers,r=void 0===n?[]:n,o=e.socket,i=void 0===o?WebSocket:o;return(0,f["default"])(!P,"configure(...): connection already configured"),P=new p["default"]({url:t,socket:i}),P.subManager=new g["default"](P),P.methodManager=new _["default"](P),P.errorManager=new b["default"](P),P.customManagers=(0,l["default"])(r,function(e){return new e(P)}),O.defaultDelegate((0,w.createCollectionDelegate)(P)),O.defaultCursor((0,E.createCursorWithSub)(P)),P}Object.defineProperty(n,"__esModule",{value:!0}),n.getConnection=o,n.call=i,n.apply=a,n.subscribe=u,n.configure=s;var c=e("fast.js/map"),l=r(c),d=e("invariant"),f=r(d),h=e("./DDPConnection"),p=r(h),y=e("./SubscriptionManager"),g=r(y),v=e("./MethodCallManager"),_=r(v),m=e("./ErrorManager"),b=r(m),w=e("./CollectionManager"),E=e("./CursorWithSub"),O="undefined"!=typeof window&&window.Mars?window.Mars.Collection:e("marsdb").Collection,P=null},{"./CollectionManager":5,"./CursorWithSub":6,"./DDPConnection":7,"./ErrorManager":8,"./MethodCallManager":11,"./SubscriptionManager":13,"fast.js/map":24,invariant:28,marsdb:void 0}],15:[function(e,t,n){const r=e("./dist");t.exports={configure:r.configure,apply:r.apply,call:r.call,subscribe:r.subsctibe}},{"./dist":14}],16:[function(e,t,n){"use strict";var r=e("../function/bindInternal3");t.exports=function(e,t,n){var o,i=e.length,a=void 0!==n?r(t,n):t;for(o=0;i>o;o++)a(e[o],o,e)}},{"../function/bindInternal3":22}],17:[function(e,t,n){"use strict";var r=e("../function/bindInternal3");t.exports=function(e,t,n){var o,i=e.length,a=new Array(i),u=void 0!==n?r(t,n):t;for(o=0;i>o;o++)a[o]=u(e[o],o,e);return a}},{"../function/bindInternal3":22}],18:[function(e,t,n){"use strict";var r=e("./array/forEach"),o=e("./object/forEach");t.exports=function(e,t,n){return e instanceof Array?r(e,t,n):o(e,t,n)}},{"./array/forEach":16,"./object/forEach":25}],19:[function(e,t,n){"use strict";t.exports=function(e,t){switch(t.length){case 0:return e();case 1:return e(t[0]);case 2:return e(t[0],t[1]);case 3:return e(t[0],t[1],t[2]);case 4:return e(t[0],t[1],t[2],t[3]);case 5:return e(t[0],t[1],t[2],t[3],t[4]);case 6:return e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return e(t[0],t[1],t[2],t[3],t[4],t[5],t[6]);case 8:return e(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7]);default:return e.apply(void 0,t)}}},{}],20:[function(e,t,n){"use strict";t.exports=function(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2]);case 4:return e.call(t,n[0],n[1],n[2],n[3]);case 5:return e.call(t,n[0],n[1],n[2],n[3],n[4]);case 6:return e.call(t,n[0],n[1],n[2],n[3],n[4],n[5]);case 7:return e.call(t,n[0],n[1],n[2],n[3],n[4],n[5],n[6]);case 8:return e.call(t,n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7]);default:return e.apply(t,n)}}},{}],21:[function(e,t,n){"use strict";var r=e("./applyWithContext"),o=e("./applyNoContext");t.exports=function(e,t){var n,i=arguments.length-2;if(i>0){n=new Array(i);for(var a=0;i>a;a++)n[a]=arguments[a+2];return void 0!==t?function(){var o,a=arguments.length,u=new Array(i+a);for(o=0;i>o;o++)u[o]=n[o];for(o=0;a>o;o++)u[i+o]=arguments[o];return r(e,t,u)}:function(){var t,r=arguments.length,a=new Array(i+r);for(t=0;i>t;t++)a[t]=n[t];for(t=0;r>t;t++)a[i+t]=arguments[t];return o(e,a)}}return void 0!==t?function(){return r(e,t,arguments)}:function(){return o(e,arguments)}}},{"./applyNoContext":19,"./applyWithContext":20}],22:[function(e,t,n){"use strict";t.exports=function(e,t){return function(n,r,o){return e.call(t,n,r,o)}}},{}],23:[function(e,t,n){"use strict";t.exports=function(e){try{return e()}catch(t){return t instanceof Error?t:new Error(t)}}},{}],24:[function(e,t,n){"use strict";var r=e("./array/map"),o=e("./object/map");t.exports=function(e,t,n){return e instanceof Array?r(e,t,n):o(e,t,n)}},{"./array/map":17,"./object/map":27}],25:[function(e,t,n){"use strict";var r=e("../function/bindInternal3");t.exports=function(e,t,n){var o,i,a=Object.keys(e),u=a.length,s=void 0!==n?r(t,n):t;for(i=0;u>i;i++)o=a[i],s(e[o],o,e)}},{"../function/bindInternal3":22}],26:[function(e,t,n){"use strict";t.exports="function"==typeof Object.keys?Object.keys:function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return t}},{}],27:[function(e,t,n){"use strict";var r=e("../function/bindInternal3");t.exports=function(e,t,n){var o,i,a=Object.keys(e),u=a.length,s={},c=void 0!==n?r(t,n):t;for(o=0;u>o;o++)i=a[o],s[i]=c(e[i],i,e);return s}},{"../function/bindInternal3":22}],28:[function(e,t,n){"use strict";var r=function(e,t,n,r,o,i,a,u){if(!e){var s;if(void 0===t)s=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var c=[n,r,o,i,a,u],l=0;s=new Error(t.replace(/%s/g,function(){return c[l++]})),s.name="Invariant Violation"}throw s.framesToPop=1,s}};t.exports=r},{}]},{},[4])(4)});